import React, { Component } from "react";

const bridge = () => (
  <svg style={{ width: "20px", height: "auto" }} viewBox="0 0 703 196">
    <use href="#right" transform="translate(351 0)" />
    <use href="#right" transform="m  console.log(p);atrix(-1 0 0 1 351 0)" />
    <use transform="translate(72 96)" href="#span" />
    <defs>
      <g id="right">
        <use transform="translate(0 23)" href="#arch_bottom" />
        <use transform="translate(0 2)" href="#arch_top" />
        <g transform="translate(0 5.5)">
          <use href="#arch_plate" />
          <use href="#arch_middle" />
        </g>
        <use transform="translate(11 23)" href="#span_supports" />
        <use transform="translate(276 59)" href="#tower" />
      </g>
      <path
        id="arch_bottom"
        d="M264 155.08l-1.473 1.353.173.189.216.139L264 155.08zm-84-82l-1.2 1.6 1.2-1.6zm85.473 80.647c-18.637-20.3-61.697-65.315-84.273-82.247l-2.4 3.2c22.224 16.668 65.03 61.387 83.727 81.753l2.946-2.706zM181.2 71.48c-27.975-20.981-55.73-43.149-101.536-59.287l-1.328 3.774C123.53 31.829 150.775 53.66 178.8 74.68l2.4-3.2zM79.664 12.193C33.828-3.925 5.543-1.92 0-1.92v4c5.455 0 33.172-1.995 78.337 13.887l1.326-3.774zm183.252 144.568l15.5 10 2.168-3.362-15.5-10-2.168 3.362z"
      />
      <path
        id="arch_top"
        d="M271 168l1.756-.958-.079-.144-.101-.13L271 168zm-68-74l-1.336 1.489L203 94zm69.576 72.768c-11.355-14.527-40.939-49.759-68.24-74.257l-2.672 2.978c27.099 24.302 56.449 59.27 67.76 73.743l3.152-2.464zm-68.24-74.257c-34.033-30.528-65.308-56.226-111.573-75.36l-1.526 3.698c45.735 18.866 76.46 44.168 110.427 74.64l2.672-2.978zM92.763 17.151C46.447-1.979 23.168-2 0-2v4c22.832 0 45.553-.02 91.237 18.849l1.526-3.698zm176.481 151.807l9 16.5 3.512-1.916-9-16.5-3.512 1.916z"
      />
      <path
        id="arch_plate"
        d="M246.5 154.5s8.6-8.1 9-8.5l16 19.5 12 21.5-20-15-17-17.5z"
      />
      <path
        id="arch_middle"
        d="M247 140.5h1.5v-.576l-.385-.427L247 140.5zm-4.5-5l1.115-1.003-.307-.341-.444-.111-.364 1.455zm-12-3l-1.061 1.061.294.293.403.101.364-1.455zM225 127h-1.5v.621l.439.44L225 127zm0-10.5h1.5v-.621l-.439-.44L225 116.5zm-5-5l1.061-1.061-.44-.439H220v1.5zm-12 0l-1.017 1.102.431.398H208v-1.5zm-6.5-6H200v.657l.483.445 1.017-1.102zm0-14.5h1.5v-1.5h-1.5V91zM186 91l-.921 1.184.406.316H186V91zm-4.5-3.5H180v.734l.579.45.921-1.184zm0-11.5h1.5v-.734l-.579-.45L181.5 76zm-4.5-3.5l.921-1.184-.481-.374-.606.067L177 72.5zM163.5 74l-.888 1.209.472.346.582-.064L163.5 74zm-3.5-2.571h-1.5v.759l.612.45.888-1.21zm0-12.929h1.5v-.75l-.6-.45-.9 1.2zm-6-4.5l.9-1.2-.686-.514-.791.33L154 54zm-12 5l-.832 1.248.668.445.741-.308L142 59zm-4.5-3H136v.803l.668.445L137.5 56zm0-13h1.5v-.803l-.668-.445L137.5 43zm-4.5-3l.832-1.248-.738-.492-.786.41L133 40zm-12.5 6.5l-.728 1.311.705.392.715-.372-.692-1.331zM116 44h-1.5v.883l.772.428L116 44zm0-13.5h1.5v-.89l-.782-.427L116 30.5zm-5.5-3l.718-1.317-.796-.434-.754.503.832 1.248zm-12 8l-.527 1.404.72.27.639-.426L98.5 35.5zm-4-1.5l-1.492.154.096.924.87.326L94.5 34zM93 19.5l1.492-.154-.09-.864-.793-.353L93 19.5zm-4.5-2l.61-1.37-.874-.389-.72.627.984 1.132zM77 27.5l-.527 1.404.837.314.674-.586L77 27.5zM73 26l-1.487.198.119.891.841.316L73 26zm-2-15l1.487-.198-.12-.901-.854-.31L71 11zm-5.5-2l.513-1.41L65 7.222l-.672.841L65.5 9zm-10 12.5l-.412 1.442.96.274.623-.779L55.5 21.5zm-3.5-1l-1.467.311.187.883.868.248L52 20.5zM48.5 4l1.467-.311-.221-1.045-1.06-.132L48.5 4zm-4-.5l.186-1.488-.852-.107-.523.68L44.5 3.5zm-10 13l-.166 1.49.84.094.515-.67L34.5 16.5zM30 16l-1.452.375.258 1.002 1.028.114L30 16zM26 .5l1.452-.375-.261-1.013-1.042-.105L26 .5zM21 0l.15-1.493-.985-.098-.478.866L21 0zm-8 14.5V16h.886l.427-.775L13 14.5zm-3.5 0l-1.369.614.398.886H9.5v-1.5zM3 0l1.369-.614L3.97-1.5H3V0zm252.5 146l1.16-.951-1.05-1.28-1.171 1.17L255.5 146zm-9 8.5l-1.028-1.092-1.109 1.045 1.061 1.092 1.076-1.045zm17 17.5l-1.076 1.045.082.084.094.071.9-1.2zm20 15l-.9 1.2 2.21-1.931-1.31.731zm-12-21.5l1.31-.731-.065-.117-.085-.103-1.16.951zm-23-13.5v-11.5h-3V152h3zm-.385-12.503l-4.5-5-2.23 2.006 4.5 5 2.23-2.006zm-5.251-5.452l-12-3-.728 2.91 12 3 .728-2.91zm-11.303-2.606l-5.5-5.5-2.122 2.122 5.5 5.5 2.122-2.122zM226.5 127v-10.5h-3V127h3zm-.439-11.561l-5-5-2.122 2.122 5 5 2.122-2.122zM220 110h-12v3h12v-3zm-10.983.398l-6.5-6-2.034 2.204 6.5 6 2.034-2.204zM203 105.5V91h-3v14.5h3zm-1.5-16H186v3h15.5v-3zm-14.579.316l-4.5-3.5-1.842 2.368 4.5 3.5 1.842-2.368zM183 87.5V76h-3v11.5h3zm-.579-12.684l-4.5-3.5-1.842 2.368 4.5 3.5 1.842-2.368zm-5.587-3.807l-13.5 1.5.332 2.982 13.5-1.5-.332-2.982zm-12.446 1.782l-3.5-2.571-1.776 2.417 3.5 2.572 1.776-2.418zM161.5 71.43V58.5h-3v12.929h3zm-.6-14.129l-6-4.5-1.8 2.4 6 4.5 1.8-2.4zm-7.477-4.685l-12 5 1.154 2.77 12-5-1.154-2.77zm-10.591 5.137l-4.5-3-1.664 2.496 4.5 3 1.664-2.496zM139 56V43h-3v13h3zm-.668-14.248l-4.5-3-1.664 2.496 4.5 3 1.664-2.496zm-6.024-3.083l-12.5 6.5 1.384 2.662 12.5-6.5-1.384-2.662zm-11.08 6.52l-4.5-2.5-1.456 2.622 4.5 2.5 1.456-2.622zM117.5 44V30.5h-3V44h3zm-.782-14.817l-5.5-3-1.436 2.634 5.5 3 1.436-2.634zm-7.05-2.931l-12 8 1.664 2.496 12-8-1.664-2.496zm-10.641 7.844l-4-1.5-1.054 2.809 4 1.5 1.054-2.81zm-3.035-.25l-1.5-14.5-2.984.308 1.5 14.5 2.984-.308zm-2.383-15.717l-4.5-2-1.218 2.742 4.5 2 1.218-2.742zm-6.093-1.76l-11.5 10 1.968 2.263 11.5-10-1.968-2.264zm-9.99 9.727l-4-1.5-1.053 2.808 4 1.5 1.054-2.808zm-3.04-.294l-2-15-2.973.396 2 15 2.974-.396zM71.514 9.59l-5.5-2-1.026 2.82 5.5 2 1.026-2.82zM64.33 8.063l-10 12.5 2.342 1.874 10-12.5-2.342-1.874zm-8.417 11.995l-3.5-1-.824 2.884 3.5 1 .824-2.884zm-2.445.13l-3.5-16.5-2.934.623 3.5 16.5 2.934-.622zm-4.78-17.676l-4-.5-.373 2.976 4 .5.372-2.976zm-5.376.073l-10 13 2.378 1.83 10-13-2.378-1.83zM34.666 15.01l-4.5-.5-.332 2.982 4.5.5.332-2.982zm-3.214.616l-4-15.5-2.904.75 4 15.5 2.904-.75zM26.15-.993l-5-.5-.298 2.986 5 .5.298-2.986zm-6.462.268l-8 14.5 2.626 1.45 8-14.5-2.626-1.45zM13 13H9.5v3H13v-3zm-2.131.886l-6.5-14.5L1.63.614l6.5 14.5 2.738-1.228zM3-1.5H0v3h3v-3zm251.439 146.439c.038-.038-.202.195-.474.454a4648.057 4648.057 0 0 1-4.144 3.916l-3 2.827-.979.923-.274.258-.072.068-.018.017-.005.005-.001.001 1.028 1.092 1.029 1.092.001-.002.005-.004a.353.353 0 0 1 .018-.017l.072-.068.274-.258.98-.923 3-2.829a944.616 944.616 0 0 0 4.682-4.43l-2.122-2.122zm-9.015 10.606l17 17.5 2.152-2.09-17-17.5-2.152 2.09zM262.6 173.2l20 15 1.8-2.4-20-15-1.8 2.4zm22.21 13.069l-12-21.5-2.62 1.462 12 21.5 2.62-1.462zm-12.15-21.72l-16-19.5-2.32 1.902 16 19.5 2.32-1.902z"
      />
      <path
        id="span_supports"
        d="M148 58v18h2V58h-2zm-21-14.5V76h2V43.5h-2zM105.5 31v45h2V31h-2zM86 76V21h-2v55h2zM63 13v63h2V13h-2zM43.5 76V6.5h-2V76h2zM20 2v74h2V2h-2zM-1 0v76h2V0h-2z"
      />
      <path
        id="tower"
        fill-rule="evenodd"
        d="M13 16v21H1v5H0v3h2v62H1v9H0v21h74v-19h-1v-3h-1v-8h-1V58h-8V37H52V8h2V3h-2V0H13v3h-2v5h2v8z"
      />
      <path id="span" d="M0 0h559v15H0V0z" />
    </defs>
  </svg>
);

const inner = ({ circleX, circleY, innerOpacity }) => (
  <svg
    className="inner"
    viewBox="0 0 100 100"
    style={{ opacity: innerOpacity }}
    y={circleY - 50}
  >
    <defs>
      <path id="curve" d="M 24 50 A 24 24 0 1 0 76 50" />
    </defs>
    <circle
      className="circle-inner"
      stroke="#ecefeb"
      fill="#fff"
      strokeWidth="0.2"
      cx="50"
      cy="50"
      r="28"
    />
    <text
      className="text name"
      x="50"
      y="42"
      width="100"
      textAnchor="middle"
      fontSize="6"
    >
      HARRY GREEN
    </text>
    <text
      className="text role"
      x="50"
      y="46"
      width="100"
      textAnchor="middle"
      fontSize="3"
    >
      Frontend Web Developer
    </text>
    {/* {bridge()} */}
    <text
      className="location"
      fontSize="2.5"
      letterSpacing="0.25"
      textAnchor="middle"
      style={{ fill: "#676D65", textTransform: "uppercase" }}
    >
      <textPath href="#curve" startOffset="50%">
        Newcastle upon Tyne
      </textPath>
    </text>
  </svg>
);

class Header extends Component {
  circleYMin = 50;
  circleYMax = 130;

  state = {
    circleX: 50,
    circleY: 50,
    circleR: 30,
    p: 0,
    polyPath: null,
    innerOpacity: 1
  };

  update = () => {
    const p = window.scrollY / window.innerHeight * 2;

    if (p > 1.1) {
      return;
    }

    let { circleX, circleY, circleR } = this.state;
    const { circleYMin, circleYMax } = this;

    circleY = circleYMin + (circleYMax - circleYMin) * p;
    let xOffset = circleR * Math.sin(p * Math.PI);

    let polyAx = circleX - xOffset;
    let polyBx = circleX + xOffset;

    let polyAy = circleY + circleR * Math.cos(p * Math.PI);
    let polyBy = polyAy;

    const d = 2 * Math.abs(5 * p - 2.5) + 10;

    // Calculate points tangent to circle for SVG curve control points
    const vx = circleX - polyAx;
    const vy = circleY - polyAy;
    const norm = Math.sqrt(vx * vx + vy * vy);
    let polyAC1x = polyAx + -1 * vy * d / norm;
    let polyAC1y = polyAy + vx * d / norm;

    if (polyAC1x > 50) {
      polyAC1x = 50;
    }

    let polyBC1x = 100 - polyAC1x;

    let polyBaseAx = polyAx - 50 * p;
    let polyBaseBx = 100 - polyBaseAx;

    const polyPath = [
      "M",
      polyBaseAx,
      100,
      "Q",
      polyAC1x,
      polyAC1y,
      polyAx,
      polyAy,
      "L",
      polyBx,
      polyBy,
      "Q",
      polyBC1x,
      polyAC1y,
      polyBaseBx,
      100,
      "Z"
    ].join(" ");

    this.setState(() => {
      return {
        circleX: circleX,
        circleY: circleY,
        polyPath: polyPath,
        innerOpacity: 1 - 3 * p
      };
    });
  };

  componentDidMount() {
    // window.requestAnimationFrame(this.update);
    window.addEventListener("scroll", this.handleScroll);
  }

  handleScroll = () => {
    this.update();
  };

  render() {
    // console.log("render");
    const { circleX, circleY, circleR, polyPath, innerOpacity } = this.state;
    return (
      <div
        className="head"
        style={{ backgroundColor: "#ecefeb", height: "100vmin" }}
        onScroll={this.handleScroll}
      >
        <svg
          className="intro"
          preserveAspectRatio="xMidYMid"
          viewBox="0 0 100 100"
          style={{ width: "100%", height: "100%" }}
        >
          <circle
            className="circle"
            fill="#fff"
            cx={circleX}
            cy={circleY}
            r={circleR}
          />
          <path className="path" fill="#fff" fillRule="evenodd" d={polyPath} />
          {inner({ circleX, circleY, innerOpacity })}
        </svg>
      </div>
    );
  }
}

export default Header;
